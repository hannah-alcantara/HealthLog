# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Next.js 16 health logging application using the App Router architecture with React 19, TypeScript, and Tailwind CSS 4. The project uses Yarn as the package manager and follows a feature-based development workflow powered by SpecKit.

## Development Commands

**Development Server**
```bash
yarn dev          # Start dev server at http://localhost:3000
yarn build        # Production build
yarn start        # Start production server
yarn lint         # Run ESLint
```

**Note**: This project uses Yarn. Do not use npm or other package managers.

## Architecture & Structure

### Next.js App Router (v16)

- **App Directory**: All routes and layouts live in `app/`
- **Layout System**: Root layout at [app/layout.tsx](app/layout.tsx) uses Geist fonts (sans and mono)
- **Styling**: Tailwind CSS 4 with PostCSS, custom theme variables in [app/globals.css](app/globals.css)
- **Dark Mode**: Supports system preference via CSS media queries (`prefers-color-scheme: dark`)

### TypeScript Configuration

- **Path Aliases**: `@/*` maps to project root (e.g., `@/app/page.tsx`)
- **JSX Runtime**: Uses `react-jsx` (no need to import React in components)
- **Strict Mode**: Enabled with full type safety

### Styling Approach

- Tailwind CSS 4 with `@tailwindcss/postcss` plugin
- Custom CSS variables for theming (`--background`, `--foreground`, `--font-geist-sans`, `--font-geist-mono`)
- Responsive utilities and dark mode classes available throughout

## SpecKit Development Workflow

This project uses a structured feature development system with slash commands in `.claude/commands/`. These commands orchestrate a spec-first workflow:

### Feature Development Lifecycle

1. **Specification** (`/speckit.specify <description>`)
   - Creates feature branch numbered `N-short-name`
   - Generates business-focused spec in `specs/N-short-name/spec.md`
   - No implementation details - focuses on WHAT and WHY, not HOW
   - Limits clarification questions to 3 maximum critical items
   - Validates spec quality before proceeding

2. **Planning** (`/speckit.plan`)
   - Converts spec into technical implementation plan
   - Generates design artifacts: `data-model.md`, `contracts/`, `research.md`, `quickstart.md`
   - Checks against project constitution (if defined in `.specify/memory/constitution.md`)
   - Updates AI agent context files with new technologies

3. **Task Generation** (`/speckit.tasks`)
   - Breaks plan into executable tasks organized by user story
   - Creates `tasks.md` with dependency graph and parallel execution opportunities
   - Tasks use strict format: `- [ ] [TaskID] [P?] [Story?] Description with file path`
   - Phases: Setup → Foundational → User Stories (by priority) → Polish

4. **Implementation** (`/speckit.implement`)
   - Executes tasks from `tasks.md` in dependency order
   - Runs in phases with validation gates

5. **Analysis** (`/speckit.analyze`)
   - Cross-artifact consistency checks across spec.md, plan.md, tasks.md

### Workflow Scripts

PowerShell scripts in `.specify/scripts/powershell/`:
- `create-new-feature.ps1` - Initializes feature branch and directory structure
- `setup-plan.ps1` - Sets up planning context and files
- `check-prerequisites.ps1` - Validates feature artifacts exist
- `update-agent-context.ps1` - Updates AI-specific context files (Claude, Cursor, etc.)

All scripts accept `-Json` flag for machine-readable output.

### Templates

Feature artifacts are generated from templates in `.specify/templates/`:
- `spec-template.md` - User story and requirements structure
- `plan-template.md` - Technical design and architecture
- `tasks-template.md` - Executable task breakdown
- `checklist-template.md` - Quality validation checklists

## Key Development Patterns

### Component Structure

- Server Components by default (App Router)
- Use `"use client"` directive only when needed (interactivity, hooks, browser APIs)
- Import Next.js optimized components: `Image`, `Link`, fonts

### Styling Conventions

- Utility-first with Tailwind
- Dark mode variants: `dark:` prefix (e.g., `dark:bg-black`)
- Responsive: `sm:`, `md:`, `lg:`, `xl:` breakpoints
- CSS variables for theme colors accessed via Tailwind config

### File Organization

```
app/
  layout.tsx        # Root layout with fonts and metadata
  page.tsx          # Home page route
  globals.css       # Global styles and theme variables
specs/
  [N-feature-name]/ # Generated by SpecKit workflow
    spec.md
    plan.md
    tasks.md
    data-model.md
    contracts/
    research.md
.specify/           # SpecKit system files
```

## Working with Features

When adding new features:

1. Start with `/speckit.specify` to create a proper specification
2. Let the workflow generate the technical plan rather than jumping to code
3. Tasks are organized by user story for independent implementation
4. Each user story phase should be independently testable

When working on an existing feature branch, the spec and plan files in `specs/[N-feature-name]/` provide the authoritative context for what's being built and why.

## Project Constitution

This project follows strict quality standards defined in [.specify/memory/constitution.md](.specify/memory/constitution.md). Key principles:

### Code Quality Requirements
- TypeScript strict mode with zero `any` types (unless justified)
- ESLint: zero errors, zero warnings before merge
- Functions must not exceed 50 lines
- No `console.log` in production builds
- All component props must have TypeScript interfaces with JSDoc

### Testing Standards (NON-NEGOTIABLE)
- **Coverage Minimums**: 80% utilities/services, 90% business logic, 100% auth/validation
- **Required Tests**: Component tests (React Testing Library), integration tests (user journeys), E2E (critical paths)
- All tests must be deterministic and isolated
- Test naming: "should [behavior] when [condition]"

### User Experience Standards
- **Accessibility**: WCAG 2.1 AA compliance required
  - Keyboard navigation for all interactive elements
  - 4.5:1 contrast ratio for text, 3:1 for large text
  - Alt text for images, labels for inputs
  - 44x44px minimum touch targets on mobile
- **Design System**: Use theme variables from globals.css consistently
- **Responsive**: Mobile-first (375px minimum), proper breakpoints (sm/md/lg/xl)

### Performance Budgets
- **Core Web Vitals**: FCP < 1.8s, LCP < 2.5s, TTI < 3.5s, CLS < 0.1
- **Bundle Sizes**: JS < 200KB gzipped, CSS < 50KB gzipped
- **Lighthouse Scores**: Performance ≥ 90, Accessibility = 100, Best Practices ≥ 90
- **Feature Budgets**: Forms < 100ms feedback, charts < 500ms render, search < 300ms

### Data Security (Health Data)
- Client-side AND server-side validation (use Zod or similar)
- No sensitive health data in logs or analytics
- Environment variables for secrets only
- Proper error boundaries for data operations

## Quality Gates

Before merging, verify:
- [ ] All tests passing with coverage thresholds met
- [ ] ESLint and TypeScript: zero errors
- [ ] Lighthouse scores meet minimums
- [ ] Mobile viewport tested, dark mode checked
- [ ] Performance budgets not exceeded

See constitution for complete quality gate checklists.

## Important Notes

- **Package Manager**: Always use `yarn`, never `npm`
- **Paths**: TypeScript paths use `@/*` for imports from root
- **ESLint**: Next.js ESLint config with TypeScript support
- **Node Version**: Designed for Node 20+
- **React Version**: Using React 19 (latest stable)
